<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GitHub Profile Analyzer</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    body {
      background: #f6f8fa;
      color: #24292e;
      line-height: 1.6;
      padding: 2rem;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #0969da;
    }
    .input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }
    input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      font-size: 1rem;
    }
    button {
      background: #0969da;
      color: white;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background: #074b9f;
    }
    #results {
      display: none;
    }
    .stat-card {
      background: #f1f8ff;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .suggestions {
      margin-top: 1.5rem;
    }
    .suggestion {
      padding: 0.75rem;
      background: #fff8c5;
      border-left: 4px solid #d9a700;
      margin-bottom: 0.75rem;
      border-radius: 0 6px 6px 0;
    }
    .loading {
      text-align: center;
      color: #57606a;
    }
    .error {
      color: #cf222e;
      text-align: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>GitHub Profile Analyzer</h1>
    <div class="input-group">
      <input type="text" id="username" placeholder="Enter GitHub username" />
      <button id="analyze">Analyze</button>
    </div>
    <div id="loading" class="loading" style="display:none;">Loading profile...</div>
    <div id="error" class="error"></div>
    <div id="results">
      <h2 id="user-title"></h2>
      <div id="stats"></div>
      <div class="suggestions">
        <h3>Suggestions</h3>
        <div id="suggestions"></div>
      </div>
    </div>
  </div>

  <script>
document.getElementById('analyze').addEventListener('click', analyzeProfile);

async function analyzeProfile() {
  const username = document.getElementById('username').value.trim();
  if (!username) return;

  const loadingEl = document.getElementById('loading');
  const errorEl = document.getElementById('error');
  const resultsEl = document.getElementById('results');

  // Reset UI
  errorEl.textContent = '';
  resultsEl.style.display = 'none';
  loadingEl.style.display = 'block';

  try {
    // 1. Fetch basic user info
    const userRes = await fetch(`https://api.github.com/users/${username}`);
    if (!userRes.ok) throw new Error('User not found');
    const user = await userRes.json();

    // 2. Fetch contribution data via GraphQL
    const query = `
      query($username: String!) {
        user(login: $username) {
          contributionsCollection {
            contributionCalendar {
              totalContributions
              weeks {
                contributionDays {
                  date
                  contributionCount
                }
              }
            }
          }
          repositories(first: 100, orderBy: {field: UPDATED_AT, direction: DESC}) {
            nodes {
              languages(first: 3, orderBy: {field: SIZE, direction: DESC}) {
                edges {
                  size
                  node {
                    name
                  }
                }
              }
            }
          }
        }
      }
    `;

    const graphqlRes = await fetch('https://api.github.com/graphql', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // No Authorization header = unauthenticated (60 req/hr)
      },
      body: JSON.stringify({
        query,
        variables: { username }
      })
    });

    const graphqlData = await graphqlRes.json();
    if (graphqlData.errors) {
      throw new Error(graphqlData.errors[0].message || 'Failed to load contribution data');
    }

    const contributions = graphqlData.data.user.contributionsCollection.contributionCalendar;
    const repos = graphqlData.data.user.repositories.nodes;

    // Parse contribution days
    const contributionDays = [];
    contributions.weeks.forEach(week => {
      week.contributionDays.forEach(day => {
        contributionDays.push({
          date: new Date(day.date),
          count: day.contributionCount
        });
      });
    });

    // Sort by date
    contributionDays.sort((a, b) => a.date - b.date);

    // Calculate streaks
    const streaks = calculateStreaks(contributionDays);
    const totalContributions = contributions.totalContributions;

    // Get top languages
    const languageMap = new Map();
    repos.forEach(repo => {
      repo.languages.edges.forEach(edge => {
        const lang = edge.node.name;
        const size = edge.size;
        languageMap.set(lang, (languageMap.get(lang) || 0) + size);
      });
    });

    const topLanguages = [...languageMap.entries()]
      .sort((a, b) => b[1] - a[1])
      .slice(0, 3)
      .map(([lang]) => lang);

    // Generate suggestions
    const suggestions = generateSuggestions(contributionDays, streaks, topLanguages);

    // Render results
    document.getElementById('user-title').textContent = `@${user.login}`;
    document.getElementById('stats').innerHTML = `
      <div class="stat-card"><strong>Total contributions (last year):</strong> ${totalContributions}</div>
      <div class="stat-card"><strong>Current streak:</strong> ${streaks.current} days</div>
      <div class="stat-card"><strong>Longest streak:</strong> ${streaks.longest} days</div>
      ${topLanguages.length ? `<div class="stat-card"><strong>Top languages:</strong> ${topLanguages.join(', ')}</div>` : ''}
    `;

    document.getElementById('suggestions').innerHTML = suggestions.map(s => 
      `<div class="suggestion">${s}</div>`
    ).join('');

    resultsEl.style.display = 'block';
  } catch (err) {
    errorEl.textContent = err.message || 'An error occurred. Try again later.';
  } finally {
    loadingEl.style.display = 'none';
  }
}

function calculateStreaks(days) {
  if (days.length === 0) return { current: 0, longest: 0 };

  let currentStreak = 0;
  let longestStreak = 0;
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  // Start from the most recent day
  let prevDate = null;
  for (let i = days.length - 1; i >= 0; i--) {
    const day = days[i];
    if (day.count === 0) continue;

    const date = new Date(day.date);
    date.setHours(0, 0, 0, 0);

    // Check if it's today or yesterday (for current streak)
    if (!prevDate) {
      const diffTime = Math.abs(today - date);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      if (diffDays <= 1) {
        currentStreak = 1;
      } else {
        currentStreak = 0;
      }
    } else {
      const diffTime = prevDate - date;
      const diffDays = diffTime / (1000 * 60 * 60 * 24);
      if (diffDays === 1) {
        currentStreak++;
      } else if (diffDays > 1) {
        break; // streak broken
      }
    }
    prevDate = date;
  }

  // For longest streak (simplified: just count consecutive days with >0 contributions)
  let tempStreak = 0;
  prevDate = null;
  for (const day of days) {
    if (day.count === 0) {
      longestStreak = Math.max(longestStreak, tempStreak);
      tempStreak = 0;
      continue;
    }
    const date = new Date(day.date);
    date.setHours(0, 0, 0, 0);
    if (prevDate && (date - prevDate) / (1000 * 60 * 60 * 24) === 1) {
      tempStreak++;
    } else {
      tempStreak = 1;
    }
    prevDate = date;
  }
  longestStreak = Math.max(longestStreak, tempStreak);

  return { current: currentStreak, longest: longestStreak };
}

function generateSuggestions(days, streaks, topLanguages) {
  const suggestions = [];

  // Days since last contribution
  const lastContributionDay = days.filter(d => d.count > 0).pop();
  if (lastContributionDay) {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const lastDate = new Date(lastContributionDay.date);
    lastDate.setHours(0, 0, 0, 0);
    const diffTime = today - lastDate;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays > 3) {
      suggestions.push(`You havenâ€™t contributed in <strong>${diffDays} days</strong>â€”time for a quick commit? ðŸ”„`);
    }
  }

  // Streak encouragement
  if (streaks.current > 0 && streaks.current >= streaks.longest * 0.8) {
    suggestions.push(`ðŸ”¥ Your current streak (${streaks.current} days) is close to your record (${streaks.longest})â€”keep it up!`);
  }

  // Most active day of week
  const dayCounts = [0, 0, 0, 0, 0, 0, 0]; // Sun to Sat
  days.filter(d => d.count > 0).forEach(d => {
    const dayOfWeek = d.date.getDay();
    dayCounts[dayOfWeek] += d.count;
  });
  const mostActiveDayIndex = dayCounts.indexOf(Math.max(...dayCounts));
  const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  const mostActiveDay = daysOfWeek[mostActiveDayIndex];
  if (dayCounts[mostActiveDayIndex] > 0) {
    suggestions.push(`Youâ€™re most active on <strong>${mostActiveDay}</strong>â€”great for planning coding sessions! ðŸ“…`);
  }

  // Language suggestion
  if (topLanguages.length > 0) {
    const mainLang = topLanguages[0];
    const langSuggestions = {
      'JavaScript': 'TypeScript (adds type safety!)',
      'Python': 'FastAPI or Pydantic for modern projects',
      'Java': 'Kotlin for more concise code',
      'C++': 'Rust for memory safety',
      'PHP': 'Laravel or Symfony for structured apps'
    };
    if (langSuggestions[mainLang]) {
      suggestions.push(`You mostly code in <strong>${mainLang}</strong>â€”have you tried <strong>${langSuggestions[mainLang]}</strong>? ðŸ’¡`);
    }
  }

  if (suggestions.length === 0) {
    suggestions.push('Great job staying active! Keep coding! ðŸŽ‰');
  }

  return suggestions;
}
  </script>
</body>
</html>
